var tiempo="";var cambioGrado,idGradoEscolar;Encoder.EncodeType="entity";$(document).ready(function(){var E=F(0,0,-3);function F(aj,al,ai){var ak="fechaServidor";var ah="---";$.post("../sources/ControladorFechas.php",{ins:ak,dias:aj,meses:al,anyos:ai},function(am){debugConsole("Res="+am);if(am){var an=am;an=an.trim();w(an);return an}})}$(".editaAtributo").click(function(ah){var aj=$(this).attr("id");var ai=$(this).attr("name");debugConsole("Getting idAtributo:"+aj);$.post("../sources/ControladorAdmin.php",{consulta:ai,idAtributo:aj},function(al){debugConsole(al);var ak=jQuery.parseJSON(al);$("#editaAtributo").val(Encoder.htmlDecode(ak.nombre_atributo));$("#idAtributo").val(ak.id_atributo);debugConsole("Campos actualizados")})});$(".editaEscuela").click(function(ah){var ai=$(this).attr("id");debugConsole("Getting idAtributo:"+ai);$.post("../sources/ControladorAdmin.Catalogos.php",{consulta:"getEscuela",idAtributo:ai},function(ak){debugConsole(ak);var aj=jQuery.parseJSON(ak);$("#editaAtributo").val(Encoder.htmlDecode(aj.nombre_escuela));$("#idAtributo").val(aj.id_escuela);$("#idInstitucion option[value="+aj.id_institucion+"]").attr("selected",true);debugConsole("Campos actualizados")})});function I(){$("#divCargandoo").show("fast")}function n(ah){$.post("../sources/ControladorPlantilla.php",{ins:"infoParaModalLinkeo",idUnidad:ah},function(ai){$("#frmLinkeo").html(ai);$("#divCargando").css("display","none")})}$("#idInstitucion").change(function(ai){document.getElementById("id_escuela").length=0;debugConsole("change institucion");var ah=$(this).val();debugConsole("idInstitucion:"+ah);$.post("../sources/ControladorAdmin.Catalogos.php",{consulta:"getEscuelas",idAtributo:ah},function(ak){if(ak){debugConsole(ak);var aj=jQuery.parseJSON(ak);for(i=0;i<aj.length;i++){debugConsole("escuela:"+aj[i].nombre_escuela);$("<option value='"+aj[i].id_escuela+"'>"+Encoder.htmlDecode(aj[i].nombre_escuela)+"</option>").appendTo("#id_escuela")}if($("#comboGrupos").length){debugConsole("idEscuelaaa:"+$("#id_escuela").val());llenaComboGrupos($("#id_escuela").val())}if(K){debugConsole("Cambiando escuela");$("#id_escuela option[value="+B+"]").attr("selected",true);K=false}if($("#enrolar").length){llenaSelectGruposDisponibles()}else{if($("#cargaAlumnos").val()==="1"){p()}}}else{$("<option value=''>Esta institución no tiene escuelas.</option>").appendTo("#id_escuela");if($("#comboGrupos").length){$("#comboGrupos").empty();$("<option>Sin información disponible.</option>").appendTo("#comboGrupos")}if(("#btnDescargar").length){$("#btnDescargar").css("display","none");$("#tablaDescarga").css("display","none")}debugConsole("Vaciar listas");$(".grupo").html("")}})});$("#idInstitucion").change();var s=true;var v=true;var ad=true;var g=true;var D=true;$("body").on("input","#contrasena",function(ah){debugConsole("#contrasena:"+$(this).val());if(!ae($(this).val())){debugConsole("contraseña ok");ad=false;$("button[type=submit]").attr("disabled","disabled");$("#errorContrasena").html("La contraseña debe tener una <br>longitud de 8 caracteres y <br>al menos un número")}else{debugConsole("Contraseña no valida");ad=true;$("#errorContrasena").html("");q()}$("#confirmaContrasena").keyup()});function ae(ai){debugConsole("Valida fortaleza");var aj=0;var ah=false;aj=ai.length;debugConsole("longitud:"+aj);for(i=0;i<aj;i++){debugConsole("ciclo");if(!isNaN(ai.charAt(i))){ah=true;debugConsole("encontre un numero!")}}if(aj>=8&&ah){return true}else{return false}}$("body").on("input","#confirmaContrasena",function(ah){debugConsole("confirmando coincidencia contraseñas");if($(this).val()!=$("#contrasena").val()){g=false;$("#errorConfirmaContrasena").html("Las contraseñas no coinciden.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorConfirmaContrasena").html("");g=true;q()}});$("#nombreUsuario").keyup(function(ai){debugConsole("Verifica usuario");var ah=aa(m($(this).val()).toLowerCase());$(this).val(ah);$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"verificaUsuario",atributo:ah},function(aj){aj=aj.trim();debugConsole("existe el usuario:"+aj);if(aj==="true"){s=false;$("#errorUsuario").html("Este nombre de usuario ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"verificaUsuarioMoodle",atributo:ah},function(ak){ak=ak.trim();debugConsole("existe el usuario en moodle:"+ak);if(ak==="true"){s=false;$("#errorUsuario").html("Este nombre de usuario ya ha sido registrado en Moodle.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorUsuario").html("");s=true;q()}})}})});$("#edita_nombre_usuario").keyup(function(aj){debugConsole("Verifica usuario");var ah=$("#id_datos_personales").val();debugConsole("id_datos_personales:"+ah);var ai=aa(m($(this).val()).toLowerCase());$(this).val(ai);$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"verificaUsuarioEditando",atributo:ai,id_datos_personales:ah},function(ak){ak=ak.trim();debugConsole("existe el usuario:"+ak);if(ak==="true"){s=false;$("#errorUsuario").html("Este nombre de usuario ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorUsuario").html("");s=true;q()}})});var U=false;$("#habEditContrasena").click(function(ah){U=!U;Z();debugConsole("habEditContrasena:"+U)});Z();function Z(){if(U){$(".editaContrasena").removeAttr("disabled")}else{$(".editaContrasena").attr("disabled","enabled")}}$("#correo").keyup(function(ai){debugConsole("Verifica usuario");var ah=aa(m($(this).val()).toLowerCase());$(this).val(ah);$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"verificaCorreo",atributo:ah},function(aj){aj=aj.trim();debugConsole("existe el correo:"+aj);if(aj!=="false"){v=false;$("#errorCorreo").html("Este correo ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorCorreo").html("");v=true;q()}})});$("#edita_correo").keyup(function(aj){debugConsole("Verifica usuario");var ah=$("#id_datos_personales").val();var ai=aa(m($(this).val()).toLowerCase());$(this).val(ai);$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"verificaCorreoEditando",atributo:ai,id_datos_personales:ah},function(ak){ak=ak.trim();debugConsole("existe el correo:"+ak);if(ak!=="false"){v=false;$("#errorCorreo").html("Este correo ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorCorreo").html("");v=true;q()}})});function q(){if(s&&v&&ad&&g&&D){$("button[type=submit]").removeAttr("disabled")}}$("#nombre_pila").keyup(function(ah){$(this).val(b($(this).val()))});$("#primer_apellido").keyup(function(ah){$(this).val(b($(this).val()))});$("#segundo_apellido").keyup(function(ah){$(this).val(b($(this).val()))});$("#delegacion_municipio").keyup(function(ah){$(this).val(b($(this).val()))});$("#colonia_localidad").keyup(function(ah){$(this).val(b($(this).val()))});$("#edita_nombre_pila").keyup(function(ah){$(this).val(b($(this).val()))});$("#edita_primer_apellido").keyup(function(ah){$(this).val(b($(this).val()))});$("#edita_segundo_apellido").keyup(function(ah){$(this).val(b($(this).val()))});$("#edita_delegacion_municipio").keyup(function(ah){$(this).val(b($(this).val()))});$("#edita_colonia_localidad").keyup(function(ah){$(this).val(b($(this).val()))});$("#fechaNac").keyup(function(ah){$(this).val(z($(this).val()))});$("#curp").keyup(function(ah){$(this).val(J($(this).val()))});$("#edita_curp").keyup(function(ah){$(this).val(J($(this).val()))});$("#edita_fecha_nacimiento").keyup(function(ah){$(this).val(z($(this).val()))});$("#telefonoFijo").keyup(function(ah){$(this).val(W($(this).val()))});$("#edita_telefono_fijo").keyup(function(ah){$(this).val(W($(this).val()))});$("#telefonoMovil").keyup(function(ah){$(this).val(W($(this).val()))});$("#edita_telefono_movil").keyup(function(ah){$(this).val(W($(this).val()))});$("#codigoPostal").keyup(function(ah){$(this).val(W($(this).val()))});$("#edita_codigo_postal").keyup(function(ah){$(this).val(W($(this).val()))});$("#edita_fecha_nacimiento").change(function(ai){var ah=$(this).val();debugConsole("Fecha:"+ah);debugConsole("Fecha Actual:"+E);if(!C(ah,E)){debugConsole("Fecha ok");D=true;$("#errorFecha").html("");q()}else{debugConsole("Nacio en el futuro");D=false;$("#errorFecha").html("No puede seleccionar una fecha donde el usuario sea menor a 3 años.");$("button[type=submit]").attr("disabled","disabled")}});$("#edita_fecha_nacimiento").keyup(function(ai){var ah=$(this).val();debugConsole("Fecha:"+ah);debugConsole("Fecha Actual:"+E);if(!C(ah,E)){debugConsole("Fecha ok");D=true;$("#errorFecha").html("");q()}else{debugConsole("Nacio en el futuro");D=false;$("#errorFecha").html("No puede seleccionar una fecha donde el usuario sea menor a 3 años.");$("button[type=submit]").attr("disabled","disabled")}});function w(ai){try{$("#fechaNac").datepicker({format:"dd/mm/yyyy",viewMode:2,onRender:function(ak){var aj=new Date(o(ai),c(ai),af(ai),0,0,0,0);return ak.valueOf()>aj.valueOf()?"disabled":""}});$("#edita_fecha_nacimiento").datepicker({format:"dd/mm/yyyy",viewMode:2,onRender:function(ak){var aj=new Date(o(ai),c(ai),af(ai),0,0,0,0);return ak.valueOf()>aj.valueOf()?"disabled":""}});$("#fechaNac").datepicker().on("changeDate",function(ak){var aj=$(this).val();debugConsole("Fecha:"+aj);debugConsole("Fecha Actual:"+ai);if(!C(aj,ai)){debugConsole("Fecha ok");D=true;$("#errorFecha").html("");q()}else{debugConsole("Nacio en el futuro");D=false;$("#errorFecha").html("No puede seleccionar una fecha donde el usuario sea menor a 3 años.");$("button[type=submit]").attr("disabled","disabled")}});$("#edita_fecha_nacimiento").datepicker().on("changeDate",function(ak){var aj=$(this).val();debugConsole("Fecha:"+aj);debugConsole("Fecha Actual:"+ai);if(!C(aj,ai)){debugConsole("Fecha ok");D=true;$("#errorFecha").html("");q()}else{debugConsole("Nacio en el futuro");D=false;$("#errorFecha").html("No puede seleccionar una fecha donde el usuario sea menor a 3 años.");$("button[type=submit]").attr("disabled","disabled")}})}catch(ah){debugConsole("No datepicker")}$("#fechaNac").change(function(ak){var aj=$(this).val();debugConsole("Fecha:"+aj);debugConsole("Fecha Actual:"+ai);if(!C(aj,ai)){debugConsole("Fecha ok");D=true;$("#errorFecha").html("");q()}else{debugConsole("Nacio en el futuro");D=false;$("#errorFecha").html("No puede seleccionar una fecha donde el usuario sea menor a 3 años.");$("button[type=submit]").attr("disabled","disabled")}});$("#fechaNac").keyup(function(ak){var aj=$(this).val();debugConsole("Fecha:"+aj);debugConsole("Fecha Actual:"+ai);if(!C(aj,ai)){debugConsole("Fecha ok");D=true;$("#errorFecha").html("");q()}else{debugConsole("Nacio en el futuro");D=false;$("#errorFecha").html("No puede seleccionar una fecha donde el usuario sea menor a 3 años.");$("button[type=submit]").attr("disabled","disabled")}})}var aa=(function(){var al="ÃÀÁÄÂÈÉËÊÌÍÏÎÒÓÖÔÙÚÜÛãàáäâèéëêìíïîòóöôùúüûÑñÇç",ak="AAAAAEEEEIIIIOOOOUUUUaaaaaeeeeiiiioooouuuunncc",ai={};for(var aj=0,ah=al.length;aj<ah;aj++){ai[al.charAt(aj)]=ak.charAt(aj)}return function(ap){var an=[];for(var ao=0,am=ap.length;ao<am;ao++){var aq=ap.charAt(ao);if(ai.hasOwnProperty(ap.charAt(ao))){an.push(ai[aq])}else{an.push(aq)}}return an.join("")}})();function W(ah){var aj="";for(var ai=0;ai<ah.length;ai++){if(!isNaN(Number(ah.charAt(ai)))){aj+=ah.charAt(ai)}}return aj.trim()}function z(ah){var aj="";for(var ai=0;ai<ah.length;ai++){if(!isNaN(Number(ah.charAt(ai)))||ah.charAt(ai)==="/"){aj+=ah.charAt(ai)}}return m(aj)}function b(ah){var aj="";for(var ai=0;ai<ah.length;ai++){if(isNaN(ah.charAt(ai))||ah.charAt(ai)===" "){aj+=ah.charAt(ai)}}return aj}function m(ah){return ah.replace(" ","").trim()}function J(ah){var aj="";for(var ai=0;ai<ah.length;ai++){if(!/[^A-Za-z\d]/.test(ah.charAt(ai))){aj+=ah.charAt(ai)}}return aj.toUpperCase()}function ac(ak,ai,ah){debugConsole("getDatosPersonalesJSON");var aj;$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"consultaDatosPersonales",atributo:ak},function(al){debugConsole("Dentro del post");debugConsole(al);if(al!="null"){al=jQuery.parseJSON(al);debugConsole("La informacion esta lista!");switch(ai){case"ver":P(al,ah);break;case"editar":O(al,ah);break}}else{debugConsole("No llegaron los datos")}});return aj}$(".verDatosPersonales").click(function(aj){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("verDatosPersonales");var ak=$(this).attr("id");var ah=$(this).attr("name");debugConsole("Getting datos personales:"+ak);var ai=ac(ak,"ver",ah)});$(".editarDatosPersonales").click(function(aj){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("verDatosPersonales");var ak=$(this).attr("id");var ah=$(this).attr("name");debugConsole("Getting datos personales:"+ak);var ai=ac(ak,"editar",ah)});function P(aj,ah){debugConsole("setDatos");$("#ver_id_datos_personales").html(aj.id_datos_personales).text();$("#ver_nombre_usuario").html(aj.nombre_usuario).text();$("#ver_correo").html(aj.correo).text();$("#ver_nombre_pila").html(aj.nombre_pila).text();$("#ver_primer_apellido").html(aj.primer_apellido).text();$("#ver_segundo_apellido").html(aj.segundo_apellido).text();$("#ver_fecha_nacimiento").html(aj.fecha_nacimiento).text();$("#ver_curp").html(aj.curp).text();$("#ver_codigo_postal").html(aj.codigo_postal).text();$("#ver_calle").html(aj.calle).text();$("#ver_no_casa_ext").html(aj.no_casa_ext).text();$("#ver_no_casa_int").html(aj.no_casa_int).text();$("#ver_colonia_localidad").html(aj.colonia_localidad).text();$("#ver_delegacion_municipio").html(aj.delegacion_municipio).text();$("#ver_entidad_federativa").html(aj.nombre_entidad).text();$("#ver_nacionalidad").html(aj.nacionalidad).text();$("#ver_zona_horaria").html(aj.zona_horaria).text();$("#ver_telefono_fijo").html(aj.telefono_fijo).text();$("#ver_telefono_movil").html(aj.telefono_movil).text();if(aj.url_foto){$("#ver_imagen").html("<img src='"+aj.url_foto+"' width='100'/>")}else{$("#ver_imagen").html("No hay imagen de perfil")}debugConsole("tipo_usuario:"+ah);switch(ah){case"estudiante":$("#ver_matricula").html(Encoder.htmlDecode(aj.matricula)).text();if(aj.nombre_padre!=null){$("#ver_padre").html(Encoder.htmlDecode(aj.nombre_padre)).text()}else{$("#ver_padre").html("No hay relación con un Padre de Familia")}if(aj.nombre_profesor!=null){$("#ver_profesor_aula").html(Encoder.htmlDecode(aj.nombre_profesor)).text()}else{$("#ver_profesor_aula").html("No hay relación con un Profesor de Aula")}$("#ver_nivel_educativo").html(Encoder.htmlDecode(aj.nivel_escolar)).text();$("#ver_grado_escolar").html(Encoder.htmlDecode(aj.grado_escolar)).text();$("#ver_institucion").html(Encoder.htmlDecode(aj.nombre_institucion)).text();$("#ver_escuela").html(Encoder.htmlDecode(aj.nombre_escuela)).text();if($("#verAlumnosGrupo").val()==="1"){$(".grupo_estudiante").show("fast");$(".grupo_profesionista").hide("fast")}break;case"profesionista":$("#ver_empresa").html(aj.nombre_empresa).text();if($("#verAlumnosGrupo").val()==="1"){$(".grupo_estudiante").hide("fast");$(".grupo_profesionista").show("fast")}break;case"tutor":$("#ver_rol_tutor").html(aj.nombre_rol).text();break;case"profesor":$("#ver_puesto_ocupacion").html(Encoder.htmlDecode(aj.puesto_ocupacion)).text();$("#ver_institucion").html(Encoder.htmlDecode(aj.nombre_institucion)).text();$("#ver_escuela").html(Encoder.htmlDecode(aj.nombre_escuela)).text();$("#ver_grado_escolar").html(Encoder.htmlDecode(aj.nombre_grado)).text();$("#ver_nivel_educativo").html(Encoder.htmlDecode(aj.nivel_escolar)).text();debugConsole("Alumnos:");$("#ver_alumnos").html("");for(var ai=0;ai<aj.alumnos.length;ai++){debugConsole(aj.alumnos[ai].nombre_pila);$("#ver_alumnos").append("<li><a href='' onclick='javascript:void(0);'>"+aj.alumnos[ai].nombre_pila+" "+aj.alumnos[ai].primer_apellido+" "+aj.alumnos[ai].segundo_apellido+"</a></li>")}break;case"padre":debugConsole("Nivel Escolar:"+aj.nivel_escolar);$("#ver_ultimo_nivel").html(Encoder.htmlDecode(aj.nivel_escolar)).text();$("#ver_ultimo_grado").html(Encoder.htmlDecode(aj.nombre_grado)).text();$("#ver_hijos").html("");debugConsole("Hijos:");$("#ver_hijos").html("");try{for(var ai=0;ai<aj.alumnos.length;ai++){debugConsole(aj.alumnos[ai].nombre_pila);$("#ver_hijos").append("<li><a href='' onclick='javascript:void(0);'>"+aj.alumnos[ai].nombre_pila+" "+aj.alumnos[ai].primer_apellido+" "+aj.alumnos[ai].segundo_apellido+"</a></li>")}}catch(ak){debugConsole("Error al cargar hijos, probablemente no tiene")}break;case"gestor":break;case"admin":break}$(".cargando").html("")}var K=false;var B=0;function O(ai,ah){debugConsole("setEditarDatos");$("#id_datos_personales").val(ai.id_datos_personales);$("#edita_nombre_usuario").val(Encoder.htmlDecode(ai.nombre_usuario));$("#edita_correo").val(Encoder.htmlDecode(ai.correo));$("#edita_nombre_pila").val(Encoder.htmlDecode(ai.nombre_pila));$("#edita_primer_apellido").val(Encoder.htmlDecode(ai.primer_apellido));$("#edita_segundo_apellido").val(Encoder.htmlDecode(ai.segundo_apellido));$("#edita_fecha_nacimiento").val(ai.fecha_nacimiento);try{$("#edita_fecha_nacimiento").datepicker("setValue",ai.fecha_nacimiento)}catch(aj){debugConsole("Error al settear fecha en datepicker")}$("#edita_curp").val(ai.curp);$("#edita_codigo_postal").val(ai.codigo_postal);$("#edita_calle").val(Encoder.htmlDecode(ai.calle));$("#edita_no_casa_ext").val(ai.no_casa_ext);$("#edita_no_casa_int").val(ai.no_casa_int);$("#edita_colonia_localidad").val(Encoder.htmlDecode(ai.colonia_localidad));$("#edita_delegacion_municipio").val(Encoder.htmlDecode(ai.delegacion_municipio));$("#edita_id_entidad_federativa option[value="+ai.id_entidad_federativa+"]").attr("selected",true);$("#edita_id_nacionalidad option[value="+ai.id_nacionalidad+"]").attr("selected",true);$("#edita_zona_horaria option[value='"+ai.zona_horaria+"']").attr("selected",true);$("#edita_telefono_fijo").val(ai.telefono_fijo);$("#edita_telefono_movil").val(ai.telefono_movil);$("#id_datos_personales").val(ai.id_datos_personales);if(ai.url_foto!=null){$("#ver_imagen").html("<img src='"+ai.url_foto+"' width='100'/>")}else{$("#ver_imagen").html("No hay imagen de perfil")}debugConsole("tipo_usuario:"+ah);switch(ah){case"estudiante":$("#edita_matricula").val(ai.matricula);$("#edita_id_padre option[value="+ai.id_padre+"]").attr("selected",true);$("#edita_id_profesor_aula option[value="+ai.id_profesor_aula+"]").attr("selected",true);$("#comboNivelEscolar option[value="+ai.id_nivel+"]").attr("selected",true);cambioGrado=true;idGradoEscolar=ai.id_grado_escolar;$("#comboNivelEscolar").change();$("#idInstitucion option[value="+ai.id_institucion+"]").attr("selected",true);K=true;B=ai.id_escuela;$("#idInstitucion").change();debugConsole("id_escuela:"+ai.id_escuela);break;case"profesionista":$("#edita_id_empresa option[value="+ai.id_empresa+"]").attr("selected",true);break;case"tutor":$("#edita_id_rol_tutor option[value="+ai.id_rol_tutor+"]").attr("selected",true);break;case"profesor":$("#edita_puesto_ocupacion").val(Encoder.htmlDecode(ai.puesto_ocupacion));$("#idInstitucion option[value="+ai.id_institucion+"]").attr("selected",true);K=true;B=ai.id_escuela;$("#idInstitucion").change();debugConsole("id_escuela:"+ai.id_escuela);$("#comboNivelEscolar option[value="+ai.id_nivel+"]").attr("selected",true);cambioGrado=true;idGradoEscolar=ai.id_grado_escolar;$("#comboNivelEscolar").change();break;case"padre":$("#comboNivelEscolar option[value="+ai.id_nivel+"]").attr("selected",true);cambioGrado=true;idGradoEscolar=ai.id_ultimo_grado_escolar;$("#comboNivelEscolar").change();break;case"gestor":break;case"admin":break}$(".cargando").html("")}function u(aj){var ak=new Date();var al=ak.getDate();var ah=ak.getMonth()+1;if(al<10){al="0"+al}if(ah<10){ah="0"+ah}if(aj==="dd-mm-yyyy"){var ai=al+"-"+ah+"-"+ak.getFullYear();return ai}else{if(aj==="dd/mm/yyyy"){var ai=al+"/"+ah+"/"+ak.getFullYear();return ai}else{if(aj==="yyyy-mm-dd"){var ai=ak.getFullYear()+"-"+ah+"-"+al;return ai}else{if(aj==="yyyy/mm/dd"){var ai=ak.getFullYear()+"/"+ah+"/"+al;return ai}else{return(false)}}}}}function u(ak,ai){var al=new Date();al=new Date(al.getTime()-(ai*24*3600*1000));var am=al.getDate();var ah=al.getMonth()+1;if(am<10){am="0"+am}if(ah<10){ah="0"+ah}if(ak==="dd-mm-yyyy"){var aj=am+"-"+ah+"-"+al.getFullYear();return aj}else{if(ak==="dd/mm/yyyy"){var aj=am+"/"+ah+"/"+al.getFullYear();return aj}else{if(ak==="yyyy-mm-dd"){var aj=al.getFullYear()+"-"+ah+"-"+am;return aj}else{if(ak==="yyyy/mm/dd"){var aj=al.getFullYear()+"/"+ah+"/"+am;return aj}else{return(false)}}}}}function C(ai,ak){ai=l(ai.trim());ak=l(ak.trim());debugConsole("Compare_dates");debugConsole("Formato estandarizado 1:"+ai);debugConsole("Formato estandarizado 2:"+ak);if(ai==null||ak==null){return false}var ah=Number(ai.substring(0,2));var am=Number(ai.substring(3,5));var an=Number(ai.substring(6,10));var ao=Number(ak.substring(0,2));var al=Number(ak.substring(3,5));var aj=Number(ak.substring(6,10));if(an>aj){return(true)}else{if(an===aj){if(am>al){return(true)}else{if(am===al){if(ah>ao){return(true)}else{return(false)}}else{return(false)}}}else{return(false)}}}function Q(ai,ak){ai=l(ai.trim());ak=l(ak.trim());if(ai==null||ak==null){return false}var ah=Number(ai.substring(0,2));var am=Number(ai.substring(3,5));var an=Number(ai.substring(6,10));var ao=Number(ak.substring(0,2));var al=Number(ak.substring(3,5));var aj=Number(ak.substring(6,10));return(ah===ao&&am===al&&an===aj)?true:false}function l(ah){var ai;if((ai=ah.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/))!=null){return ah}else{if((ai=ah.match(/^(\d{1,2})\-(\d{1,2})\-(\d{4})$/))!=null){return ai[1]+"/"+ai[2]+"/"+ai[3]}else{if((ai=ah.match(/^(\d{4})\-(\d{1,2})\-(\d{1,2})$/))!=null){return ai[3]+"/"+ai[2]+"/"+ai[1]}else{if((ai=ah.match(/^(\d{4})\/(\d{1,2})\/(\d{1,2})$/))!=null){return ai[3]+"/"+ai[2]+"/"+ai[1]}else{return null}}}}}var k=true;$("#nuevoCurso").submit(function(ah){$(".bar").show("fast")});$("body").on("change",".contenido",function(){debugConsole("Validando nuevo contenido");var ah="zip";if(!V($(this).val(),ah)){$(this).val("");try{$("#error").modal({show:true})}catch(ai){alert("Tipo de extensión para contenidos no válido. Solo admiten archivos ZIP.")}}});$("#rango1").on("input",function(ah){$("#repRango1").val(Number($(this).val())+1);ag()});$("#rango2").on("input",function(ah){$("#repRango2").val(Number($(this).val())+1);ag()});$("#rango3").on("input",function(ah){$("#repRango3").val(Number($(this).val())+1);ag()});function ag(){var aj=true;var ai=true;var ah=true;var ao=$("#rango1").val();var an=$("#rango2").val();var am=$("#rango3").val();var ak=$("#rango4").val();if(ao!==""&&an!==""){try{if(Number(ao)>=Number(an)){aj=false;$("#errorRango2").html("Error. El rango 2 es menor o igual al rango 1")}else{aj=true;$("#errorRango2").html("")}}catch(al){aj=false;$("#errorRango2").html("Error. El formato es incorrecto")}}if(an!==""&&am!==""){try{if(Number(an)>=Number(am)){ai=false;$("#errorRango3").html("Error. El rango 3 es menor o igual al rango 2")}else{ai=true;$("#errorRango3").html("")}}catch(al){ai=false;$("#errorRango3").html("Error. El formato es incorrecto")}}if(am!==""&&ak!==""){try{if(Number(am)>=Number(ak)){ah=false;$("#errorRango4").html("Error. El rango  3 es mayor o igual al rango 4")}else{ah=true;$("#errorRango4").html("")}}catch(al){ah=false;$("#errorRango4").html("Error. El formato es incorrecto")}}if(aj&&ai&&ah&&M){$("button[type=submit]").removeAttr("disabled")}else{$("button[type=submit]").attr("disabled","disabled")}}function V(ai,ah){ai=ai.trim();ah=ah.trim();var aj=ai.split(".");if(aj[aj.length-1]!==ah){debugConsole("Error, extension no valida. Prueba:"+ai+" ext:"+ah);return false}else{return true}}var Y=true;var M=true;var e=true;$("#nombre_curso").keyup(function(ah){debugConsole("Verifica nombre del curso");var ai=$(this).val();$.post("../sources/ControladorAdmin.Cursos.php",{consulta:"validaNombreCurso",atributo:ai},function(aj){debugConsole("existe el nombre del curso:"+aj);if(aj==="true"){Y=false;$("#errorNombreCurso").html("El nombre del curso ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorNombreCurso").html("");Y=true;r()}})});$("#nombre_corto").keyup(function(ai){debugConsole("Verifica clave del curso");var ah=$(this).val();$.post("../sources/ControladorAdmin.Cursos.php",{consulta:"validaNombreCorto",atributo:ah},function(aj){debugConsole("existe la clave del curso:"+aj);if(aj==="true"){e=false;$("#errorNombreCorto").html("El nombre corto ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorNombreCorto").html("");e=true;r()}})});$("#clave_curso").on("input",function(ah){debugConsole("Verifica clave del curso");var ai=$(this).val();$.post("../sources/ControladorAdmin.Cursos.php",{consulta:"validaClaveCurso",atributo:ai},function(aj){debugConsole("existe la clave del curso:"+aj);if(aj==="true"){M=false;$("#errorClaveCurso").html("La clave del curso ya ha sido registrada.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorClaveCurso").html("");M=true;r()}})});function r(){debugConsole("verifica success formulario");if(Y&&M&&e){debugConsole("Se permite el submit");$("button[type=submit]").removeAttr("disabled")}}$(".verCurso").click(function(ai){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("verCurso");var aj=$(this).attr("name");debugConsole("Getting datos curso:"+aj);var ah=R(aj,"ver")});$(".editaCurso").click(function(ai){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("editaCurso");var aj=$(this).attr("name");debugConsole("Getting datos personales:"+aj);var ah=R(aj,"editar")});function R(aj,ah){debugConsole("getDatosCusoJSON");var ai;$.post("../sources/ControladorAdmin.Cursos.php",{consulta:"consultaInfoCurso",atributo:aj},function(ak){debugConsole("Dentro del post");debugConsole(ak);if(ak){ak=jQuery.parseJSON(ak);debugConsole("La informacion esta lista!");switch(ah){case"ver":y(ak);break;case"editar":A(ak);break}}});return ai}function y(ai){$(".cargando").html("");debugConsole("setVerDatosCurso");$("#ver_curso_moodle").html(ai.curso_moodle).text();$("#ver_gestor").html(ai.gestor).text();$("#ver_clave_curso").html(ai.clave_curso).text();$("#ver_nombre_curso").html(ai.nombre_curso).text();$("#ver_nombre_corto").html(ai.nombre_corto).text();$("#ver_categoria").html(ai.nombre_categoria).text();$("#ver_asignatura").html(Encoder.htmlDecode(ai.nombre_asignatura)).text();$("#ver_nivel_escolar").html(ai.nivel).text();$("#ver_grado_escolar").html(ai.nombre_grado).text();$("#probar_curso").html("<a href='../mapaCurso/index.php?alumno=no&idCurso="+ai.id_curso+"' target='_blank'>Probar Curso</a>");$("#ver_topicos").html("");for(i=0;i<ai.topicos.length;i++){$("#ver_topicos").append("<tr>");$("#ver_topicos").append("<td><b>Unidad "+ai.topicos[i].no_unidad+"</b></td><td></td>");$("#ver_topicos").append("</tr>");$("#ver_topicos").append("<tr>");$("#ver_topicos").append("<td>Nombre Unidad:</td>");$("#ver_topicos").append("<td>"+ai.topicos[i].nombre_unidad+"</td>");$("#ver_topicos").append("</tr>");$("#ver_topicos").append("<tr>");$("#ver_topicos").append("<td>Descripción:</td>");$("#ver_topicos").append("<td>"+ai.topicos[i].descripcion+"</td>");$("#ver_topicos").append("</tr>");$("#ver_topicos").append("<tr>");$("#ver_topicos").append("<td>Estatus</td>");var ah="";if(ai.topicos[i].status==="1"){ah="<p class='text-success'><b>Activo</b></p>"}else{ah="<p class='text-error'><b>Inactivo</b></p>"}$("#ver_topicos").append("<td>"+ah+"</td>");$("#ver_topicos").append("</tr>");$("#ver_topicos").append("</tr>")}}function A(aj){$(".cargando").html("");debugConsole("setEditarDatosCurso");$("#id_curso").val(aj.id_curso);$("#ver_curso_moodle2").html(aj.curso_moodle).text();$("#edita_clave_curso").val(Encoder.htmlDecode(aj.clave_curso));$("#edita_nombre_curso").val(Encoder.htmlDecode(aj.nombre_curso));$("#edita_nombre_corto").val(Encoder.htmlDecode(aj.nombre_corto));$("#edita_categoria option[value="+aj.id_categoria+"]").attr("selected",true);$("#edita_asignatura option[value="+aj.id_asignatura+"]").attr("selected",true);$("#comboNivelEscolar option[value="+aj.id_nivel+"]").attr("selected",true);cambioGrado=true;idGradoEscolar=aj.id_grado;$("#comboNivelEscolar").change();debugConsole("el grado es"+aj.grado);$("#edita_contenido").html("");for(i=0;i<aj.topicos.length;i++){$("#edita_contenido").append("<tr>");$("#edita_contenido").append("<td><b>Unidad "+aj.topicos[i].no_unidad+"</b></td><td></td>");$("#edita_contenido").append("</tr>");$("#edita_contenido").append("<tr>");$("#edita_contenido").append("<td>Nombre Unidad:</td>");$("#edita_contenido").append("<td><input type='text' name='nombre_unidad[]' value='"+aj.topicos[i].nombre_unidad+"'/></td>");$("#edita_contenido").append("</tr>");$("#edita_contenido").append("<tr>");$("#edita_contenido").append("<td>Descripción:</td>");$("#edita_contenido").append("<td><input type='text' name='descripcion[]' value='"+aj.topicos[i].descripcion+"'/></td>");$("#edita_contenido").append("</tr>");$("#edita_contenido").append("<tr>");$("#edita_contenido").append("<td>Estatus:</td>");var ah="<select name='status[]'>";if(aj.topicos[i].status==="1"){ah+="<option value='1' selected='selected'>Activo</option>";ah+="<option value='0'>Inactivo</option>"}else{ah+="<option value='1'>Activo</option>";ah+="<option value='0' selected='selected'>Inactivo</option>"}ah+="</select>";debugConsole("status: "+ah);$("#edita_contenido").append("<td>"+ah+"</td>");$("#edita_contenido").append("</tr>");$("#edita_contenido").append("<input type='hidden' name='id_unidad[]' value='"+aj.topicos[i].id_unidad+"'>");var ai="";if(aj.topicos[i].url_unidad!=null){ai="<p class='text-success'><b>Contenido HTML5 existente</b></p>"}else{ai="<p class='text-error'><b>Contenido HTML5 no existente</b></p>"}$("#edita_contenido").append("<tr>");$("#edita_contenido").append("<td>Contenido HTML5 <small>(*Si deja el cotenido vacío, este no se actualizará)</small>:</td>");$("#edita_contenido").append("<td><input type='file' name='contenido[]' class='contenido'>"+ai+"</td>");$("#edita_contenido").append("</tr>")}}$("#editarCurso").submit(function(ah){$(".cargando").html("<h4><b>Actualizando datos, espere un momento...</b><img src='../img/loading.gif' width='30'></h4>")});function L(ai){var ah=document.getElementById(ai);for(i=0;i<ah.length;i++){debugConsole("Seleccionando:"+ah.options[i].text);ah.options[i].selected=true}}function x(aj){var ai=document.getElementById(aj);var ah=0;for(i=0;i<ai.length;i++){debugConsole("Seleccionando:"+ai.options[i].text);if(ai.options[i].selected){ah++}}return ah}var f=true;var j=true;$("#formAbrirCurso").submit(function(ah){debugConsole("Guardando curso abierto...");L("select-to");L("select-to2");L("select-to3");if(x("select-to")==0){debugConsole("Se cancelo el submit");$("#errorCoord").show("fast");ah.preventDefault()}});$("#formEnrolarTutores").submit(function(ah){debugConsole("Guardando tutores en curso abierto");debugConsole("seleccionando combo coords select-to");L("select-to");debugConsole("selecconando combos select-to");$(".select-to").each(function(){var ai=$(this).attr("title");debugConsole("id del select to:"+ai);L("select-to"+ai)});if(x("select-to")==0){debugConsole("Se cancelo el submit");$("#errorCoord").show("fast");ah.preventDefault()}});$(".btn").click(function(){if($("#enrolar").length){$("#cambio").val(1)}});$("#btnErrorCoord").click(function(ah){$("#errorCoord").hide("fast")});$("#fecha_inicio").change(function(ah){a("fecha_inicio","fecha_fin")});$("body").on("input","#fecha_inicio",function(ah){a("fecha_inicio","fecha_fin")});$("#fecha_fin").change(function(ah){a("fecha_inicio","fecha_fin")});$("body").on("input","#fecha_fin",function(ah){a("fecha_inicio","fecha_fin")});$("#edita_fecha_inicio").change(function(ah){a("edita_fecha_inicio","edita_fecha_fin")});$("body").on("input","#edita_fecha_inicio",function(ah){a("edita_fecha_inicio","edita_fecha_fin")});$("#edita_fecha_fin").change(function(ah){a("edita_fecha_inicio","edita_fecha_fin")});$("body").on("input","#edita_fecha_fin",function(ah){a("edita_fecha_inicio","edita_fecha_fin")});$("body").on("input",".fecha_inicio",function(){ab()});$("body").on("input",".fecha_fin",function(){ab()});function ab(){debugConsole("validaFechasUnidades----------------------------------");var ah=true;$.each($(".fecha_inicio"),function(ak,an){var aj=$(this).val();var al=$("#fecha_fin"+ak).val();debugConsole("fechas de unidades "+ak);debugConsole("noItem:"+ak);debugConsole("fecha inicio:"+aj);debugConsole("fecha fin:"+al);if(aj!=""&&al!=""){if(!C(aj,al)){debugConsole("Fecha ok");$("#errorFecha"+ak).html("");$("#errorFechaRango"+ak).html("");var ai=$("#fecha_inicio").val();var am=$("#fecha_fin").val();if((C(al,ai)||Q(al,ai))&&(C(am,al)||Q(am,al))&&(C(am,aj)||Q(am,aj))&&(C(aj,ai)||Q(aj,ai))){}else{ah=false;$("#errorFechaRango"+ak).html("La fecha inicio y terminación de la unidad no están dentro del rango de fecha inicio y terminación del curso abierto. ")}}else{debugConsole("Fecha inicio mayor a la final");ah=false;$("#errorFecha"+ak).html("La fecha de inicio es mayor a la fecha fin.")}}});if(ah){j=true;G()}else{j=false;$("button[type=submit]").attr("disabled","disabled")}}function a(ai,ah){var aj=$("#"+ai).val();debugConsole("fecha inicio:"+aj);var ak=$("#"+ah).val();debugConsole("fecha fin:"+ak);if(aj!=""&&ak!=""){if(!C(aj,ak)){debugConsole("Fecha ok");f=true;$("#errorFecha").html("");G()}else{debugConsole("Fecha inicio mayor a la final");f=false;$("#errorFecha").html("La fecha de inicio es mayor a la fecha fin.");$("button[type=submit]").attr("disabled","disabled")}}}function G(){if(f&&j){$("button[type=submit]").removeAttr("disabled")}}$(".verCursoAbierto").click(function(ai){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("verCursoAbierto");var aj=$(this).attr("name");debugConsole("Getting datos curso abierto:"+aj);var ah=X(aj,"ver")});$(".editaCursoAbierto").click(function(ai){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("editaCurso");var aj=$(this).attr("name");debugConsole("Getting datos personales:"+aj);var ah=X(aj,"editar")});function X(aj,ah){debugConsole("getDatosCusoAbiertoJSON");var ai;$.post("../sources/ControladorAdmin.Cursos.php",{consulta:"consultaInfoCursoAbierto",atributo:aj},function(ak){debugConsole("Dentro del post");if(ak){ak=jQuery.parseJSON(ak);debugConsole(ak);debugConsole("La informacion esta lista!");switch(ah){case"ver":d(ak);break;case"editar":t(ak);break}}});return ai}function d(ah){$(".cargando").html("");debugConsole("setVerDatosCursoAbierto");$("#ver_nombre_curso").html(ah.nombre_curso).text();$("#ver_nombre_curso_abierto").html(ah.nombre_curso_abierto).text();$("#ver_descripcion").html(ah.descripcion).text();$("#ver_fecha_inicio").html(ah.fecha_inicio).text();$("#ver_fecha_fin").html(ah.fecha_fin).text();$("#ver_fecha_unidades").html("");debugConsole("leng datos fechas unidades:"+ah.fechas_unidades.length);for(i=0;i<ah.fechas_unidades.length;i++){$("#ver_fecha_unidades").append("<tr>");$("#ver_fecha_unidades").append("<td><b>Unidad "+ah.fechas_unidades[i].no_unidad+"</b></td><td></td>");$("#ver_fecha_unidades").append("</tr>");$("#ver_fecha_unidades").append("<tr>");$("#ver_fecha_unidades").append("<td>Nombre Unidad:</td>");$("#ver_fecha_unidades").append("<td>"+ah.fechas_unidades[i].nombre_unidad+"</td>");$("#ver_fecha_unidades").append("</tr>");$("#ver_fecha_unidades").append("<tr>");$("#ver_fecha_unidades").append("<td>Descripción:</td>");$("#ver_fecha_unidades").append("<td>"+ah.fechas_unidades[i].descripcion+"</td>");$("#ver_fecha_unidades").append("</tr>");$("#ver_fecha_unidades").append("<tr>");$("#ver_fecha_unidades").append("<td>Fecha de Inicio:</td>");$("#ver_fecha_unidades").append("<td>"+ah.fechas_unidades[i].fecha_inicio+"</td>");$("#ver_fecha_unidades").append("</tr>");$("#ver_fecha_unidades").append("<tr>");$("#ver_fecha_unidades").append("<td>Fecha Fin:</td>");$("#ver_fecha_unidades").append("<td>"+ah.fechas_unidades[i].fecha_fin+"</td>");$("#ver_fecha_unidades").append("</tr>")}}function t(ah){$(".cargando").html("");debugConsole("setEditarDatosCursoAbierto");$("#id_curso_abierto").val(ah.id_curso_abierto);$("#ver_nombre_curso2").html(ah.nombre_curso).text();$("#edita_nombre_curso_abierto").val(Encoder.htmlDecode(ah.nombre_curso_abierto));$("#edita_descripcion").val(Encoder.htmlDecode(ah.descripcion));$("#edita_fecha_inicio").val(Encoder.htmlDecode(ah.fecha_inicio));$("#edita_fecha_fin").val(Encoder.htmlDecode(ah.fecha_fin));$("#editar_fechas_unidades").html("");for(i=0;i<ah.fechas_unidades.length;i++){$("#editar_fechas_unidades").append("<tr>");$("#editar_fechas_unidades").append("<td><b>Unidad "+ah.fechas_unidades[i].no_unidad+"</b></td><td></td>");$("#editar_fechas_unidades").append("</tr>");$("#editar_fechas_unidades").append("<tr>");$("#editar_fechas_unidades").append("<td>Nombre Unidad:</td>");$("#editar_fechas_unidades").append("<td>"+ah.fechas_unidades[i].nombre_unidad+"</td>");$("#editar_fechas_unidades").append("</tr>");$("#editar_fechas_unidades").append("<tr>");$("#editar_fechas_unidades").append("<td>Descripción:</td>");$("#editar_fechas_unidades").append("<td>"+ah.fechas_unidades[i].descripcion+"</td>");$("#editar_fechas_unidades").append("</tr>");$("#editar_fechas_unidades").append("<tr>");$("#editar_fechas_unidades").append("<td>Fecha de Inicio:</td>");$("#editar_fechas_unidades").append("<td><input type='date' name='fecha_inicio[]' id='fecha_inicio"+i+"' class='fecha_inicio' value='"+ah.fechas_unidades[i].fecha_inicio+"'></td>");$("#editar_fechas_unidades").append("</tr>");$("#editar_fechas_unidades").append("<tr>");$("#editar_fechas_unidades").append("<td>Fecha de Fin:</td>");$("#editar_fechas_unidades").append("<td><input type='date' name='fecha_fin[]' id='fecha_fin"+i+"' class='fecha_fin' value='"+ah.fechas_unidades[i].fecha_fin+"'>\n                                                <label class='text-error' id='errorFecha"+i+"'></label></td>");$("#editar_fechas_unidades").append("</tr>");$("#editar_fechas_unidades").append("<input type='hidden' name='id_unidad[]' value='"+ah.fechas_unidades[i].id_unidad+"'>");$("#editar_fechas_unidades").append("<input type='hidden' name='id_fechas_unidades_cursos[]' value='"+ah.fechas_unidades[i].id_fecha_unidades_curso+"'>")}debugConsole($("#editar_fechas_unidades").val())}$("#editarCurso").submit(function(ah){$(".cargando").html("<h4><b>Actualizando datos, espere un momento...</b><img src='../img/loading.gif' width='30'></h4>")});$("#id_escuela").change(function(ah){debugConsole("id_escuela change");if($("#enrolar").length){llenaSelectGruposDisponibles()}else{if($("#cargaAlumnos").val()==="1"){p()}}});$("#id_empresa").change(function(ah){debugConsole("id_empersa change");if($("#enrolar").length){}else{if($("#cargaAlumnos").val()==="1"){p()}}});$("#tipo_grupo").change(function(ah){debugConsole("tipo_grupo:"+$(this).val());if($(this).val()==="0"){debugConsole("tipo_grupo: grupo estudiantes");$(".grupo_estudiante").show("fast");$(".grupo_profesionista").hide("fast")}else{if($(this).val()==="1"){debugConsole("tipo_grupo: grupo profesionistas");$(".grupo_estudiante").hide("fast");$(".grupo_profesionista").show("fast")}}if($("#enrolar").length){llenaSelectGruposDisponibles()}else{if($("#cargaAlumnos").val()==="1"){p()}}});function p(){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");var ah=$("#tipo_grupo").val();debugConsole("cargaAlumnosDisponiboles");$(".grupo").html("");if(ah==="0"){var aj=$("#id_escuela").val();debugConsole("cargando alumnos de una escula:"+aj);$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"getAlumnosEscuela",atributo:aj},function(ak){debugConsole(ak);if(ak!="null"){$("#noAlumnos").hide("fast");ak=jQuery.parseJSON(ak);debugConsole(ak);for(i=0;i<ak.length;i++){$("#select-from").append("<option value='"+ak[i].id_alumno+"'>"+ak[i].nombre_pila+" "+ak[i].primer_apellido+" "+ak[i].segundo_apellido+"</option>")}}else{debugConsole("no hay alumnos");$("#noAlumnos").show("fast")}$(".cargando").html("")})}else{if(ah==="1"){var ai=$("#id_empresa").val();debugConsole("Cargando alumnos empresa:"+ai);$.post("../sources/Controlador.Admin.Usuarios.php",{consulta:"getAlumnosEmpresa",atributo:ai},function(ak){debugConsole(ak);if(ak!="null"){$("#noAlumnos").hide("fast");ak=jQuery.parseJSON(ak);debugConsole(ak);for(i=0;i<ak.length;i++){$("#select-from").append("<option value='"+ak[i].id_alumno+"'>"+ak[i].nombre_pila+" "+ak[i].primer_apellido+" "+ak[i].segundo_apellido+"</option>")}}else{debugConsole("no hay alumnos");$("#noAlumnos").show("fast")}$(".cargando").html("")})}}}$("#formAltaGrupo").submit(function(ah){debugConsole("Guardando grupo...");L("select-to")});$(".editarGrupo").click(function(ai){$(".cargando").html("<h4><b>Cargando datos...</b><img src='../img/loading.gif' width='30'></h4>");debugConsole("Editar grupo");var ah=$(this).attr("name");$.post("../sources/Controlador.Admin.Grupos.php",{consulta:"consultaInfoGrupo",atributo:ah},function(aj){debugConsole(aj);if(aj){aj=jQuery.parseJSON(aj);debugConsole(aj);debugConsole("Los datos estan listos!");$(".cargando").html("");$("#id_grupo").val(aj.id_grupo);$("#edita_nombre_grupo").val(Encoder.htmlDecode(aj.nombre_grupo));$("#edita_clave").val(Encoder.htmlDecode(aj.clave));$("#tipo_grupo").val(aj.tipo_grupo);if(aj.tipo_grupo==="0"){debugConsole("idInstitucion---------------:"+aj.id_institucion);$("#idInstitucion option[value="+aj.id_institucion+"]").attr("selected",true);K=true;B=aj.id_escuela;$("#idInstitucion").change()}else{if(aj.tipo_grupo==="1"){$("#id_empresa option[value="+aj.id_empresa+"]").attr("selected",true)}}$("#tipo_grupo").change()}})});var N=true;$("#clave_grupo").on("input",(function(ah){debugConsole("Verifica grupo clave");var ai=$(this).val();$.post("../sources/Controlador.Admin.Grupos.php",{consulta:"consultaClaveGrupo",atributo:ai},function(aj){debugConsole("existe el grupo:"+aj);if(aj==="true"){N=false;$("#errorGrupo2").html("La Clave del grupo ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorGrupo2").html("");N=true;H()}})}));$("#edita_nombre_grupo").keyup(function(ai){debugConsole("Verifica grupo editando");var aj=$(this).val();var ah=$("#id_grupo").val();$.post("../sources/Controlador.Admin.Grupos.php",{consulta:"consultaNombreGrupoEditando",atributo:aj,idGrupo:ah},function(ak){debugConsole("existe el grupo:"+ak);if(ak==="true"){N=false;$("#errorGrupo").html("Este nombre ya ha sido registrado.");$("button[type=submit]").attr("disabled","disabled")}else{$("#errorGrupo").html("");N=true;H()}})});function H(){if(N){$("button[type=submit]").removeAttr("disabled")}}$("#excel").change(function(ai){debugConsole("Cambia excel");var ah="zip";if(!V($(this).val(),"xls")&&!V($(this).val(),"xlsx")){$(this).val("");$("#error").modal({show:true})}});$("#cargaMasiva").submit(function(){$(".bar").show("fast")});$("#frmRelCursoGrupo").submit(function(ah){L("select-to")});function T(){var ah=document.getElementById("procesoMasiva");h=ah.scrollHeight;ah.scrollTop=h}function S(ah){$("#mensaje").html("Carga de Datos Concluida");$("#continuar").html("<a href='"+ah+"' class='btn btn-success'>Continuar</a>")}function o(ah){return ah.substring(6,10)}function c(ah){return Number(ah.substring(3,5))-1}function af(ah){return ah.substring(0,2)}$(".editaGrado").click(function(ah){var ai=$(this).attr("id");debugConsole("Getting idAtributo:"+ai);$.post("../sources/ControladorAdmin.Catalogos.php",{consulta:"getGradoEscolar",idAtributo:ai},function(ak){debugConsole(ak);if(ak){var aj=jQuery.parseJSON(ak);$("#editaAtributo").val(Encoder.htmlDecode(aj.nombre_grado));$("#idAtributo").val(aj.id_grado_escolar);$("#id_nivel_escolar option[value="+aj.id_nivel+"]").attr("selected",true);debugConsole("Campos actualizados")}else{if(confirm("Ocurrió un error al cargar los datos, por favor recargue la página")){location.reload()}}})});$("#imagen").change(function(){$("#url-archivo").val($(this).val())});$("#cancelarUPFile").click(function(){window.location.reload()});$("#excel").change(function(){$("#url-archivo").val($(this).val())});$("#excel2").change(function(){$("#url-archivo2").val($(this).val())});$("#reportesFORM").submit(function(ah){if($("#dpd1").length&&$("#dpd2").length){debugConsole("ENTRO");if(!C($("#dpd1").val(),$("#dpd2").val())){return}alert("Rango de Fechas Invalido");ah.preventDefault()}});$("#confirmAltaMasiva").click(function(){$("#progress").show("fast")});$("form").submit(function(ah){$(this).attr("disabled","disabled");$("button[type=submit]").attr("disabled","disabled");$("input[type=submit]").attr("disabled","disabled")})});